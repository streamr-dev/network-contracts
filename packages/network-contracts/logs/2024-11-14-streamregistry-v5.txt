$ ./scripts/2024-11-14-streamregistry-v5.sh
+ export CHAIN=polygon
+ CHAIN=polygon
+ declare -p KEY
+ echo 'Using deployer private key from environment variable KEY'
Using deployer private key from environment variable KEY
+ export CONTRACT_NAME=StreamRegistryV5
+ CONTRACT_NAME=StreamRegistryV5
+ export OUTPUT_FILE=newImplementationAddress.txt
+ OUTPUT_FILE=newImplementationAddress.txt
+ export SCRIPT_FILE=scripts/upgradeStreamRegistry.ts
+ SCRIPT_FILE=scripts/upgradeStreamRegistry.ts
+ npm run hardhatScript

> @streamr/network-contracts@7.1.1 hardhatScript
> hardhat run --network $CHAIN $SCRIPT_FILE

You have both ethereum-waffle and @nomicfoundation/hardhat-chai-matchers installed. They don't work correctly together, so please make sure you only use one.

We recommend you migrate to @nomicfoundation/hardhat-chai-matchers. Learn how to do it here: https://hardhat.org/migrate-from-waffle
 ·----------------------------------|--------------------------------|--------------------------------·
 |  Solc version: 0.8.13            ·  Optimizer enabled: true       ·  Runs: 100                     │
 ···································|································|·································
 |  Contract Name                   ·  Deployed size (KiB) (change)  ·  Initcode size (KiB) (change)  │
 ···································|································|·································
 |  AcceptEverythingPaymaster       ·                 3.571 (0.000)  ·                 3.694 (0.000)  │
 ···································|································|·································
 |  AddressUpgradeable              ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  AddressUpgradeable              ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  AdminKickPolicy                 ·                11.931 (0.000)  ·                11.976 (0.000)  │
 ···································|································|·································
 |  BasicToken                      ·                 0.497 (0.000)  ·                 0.528 (0.000)  │
 ···································|································|·································
 |  BufferChainlink                 ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  CBORChainlink                   ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  Chainlink                       ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  ClonesUpgradeable               ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  DefaultDelegationPolicy         ·                18.962 (0.000)  ·                19.007 (0.000)  │
 ···································|································|·································
 |  DefaultExchangeRatePolicy       ·                18.966 (0.000)  ·                19.011 (0.000)  │
 ···································|································|·································
 |  DefaultLeavePolicy              ·                11.669 (0.000)  ·                11.714 (0.000)  │
 ···································|································|·································
 |  DefaultUndelegationPolicy       ·                19.318 (0.000)  ·                19.363 (0.000)  │
 ···································|································|·································
 |  ECDSA                           ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  ECDSAUpgradeable                ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  ENSCache                        ·                 7.256 (0.000)  ·                 7.967 (0.000)  │
 ···································|································|·································
 |  ENSCacheV1                      ·                 6.815 (0.000)  ·                 7.526 (0.000)  │
 ···································|································|·································
 |  ENSCacheV2Streamr               ·                 5.178 (0.000)  ·                 5.252 (0.000)  │
 ···································|································|·································
 |  ENSRegistry                     ·                 2.417 (0.000)  ·                 2.504 (0.000)  │
 ···································|································|·································
 |  ERC20                           ·                 2.190 (0.000)  ·                 2.832 (0.000)  │
 ···································|································|·································
 |  ERC20Mintable                   ·                 2.525 (0.000)  ·                 3.192 (0.000)  │
 ···································|································|·································
 |  ERC20Upgradeable                ·                 2.097 (0.000)  ·                 2.128 (0.000)  │
 ···································|································|·································
 |  FIFSRegistrar                   ·                 0.574 (0.000)  ·                 0.731 (0.000)  │
 ···································|································|·································
 |  Forwarder                       ·                 4.759 (0.000)  ·                 5.229 (0.000)  │
 ···································|································|·································
 |  GsnEip712Library                ·                 1.294 (0.000)  ·                 1.351 (0.000)  │
 ···································|································|·································
 |  GsnUtils                        ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  LinkToken                       ·                 2.676 (0.000)  ·                 2.736 (0.000)  │
 ···································|································|·································
 |  MathUpgradeable                 ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  MaxOperatorsJoinPolicy          ·                11.454 (0.000)  ·                11.499 (0.000)  │
 ···································|································|·································
 |  MinimalForwarder                ·                 2.813 (0.000)  ·                 3.156 (0.000)  │
 ···································|································|·································
 |  MinimalForwarderUpgradeable     ·                 2.394 (0.000)  ·                 2.425 (0.000)  │
 ···································|································|·································
 |  MinLibBytes                     ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  MockERC1271                     ·                 1.637 (0.000)  ·                 1.668 (0.000)  │
 ···································|································|·································
 |  MockRandomOracle                ·                 0.734 (0.000)  ·                 0.921 (0.000)  │
 ···································|································|·································
 |  NetworkParameters               ·                 1.621 (0.000)  ·                 2.296 (0.000)  │
 ···································|································|·································
 |  NodeDomainNameHelper            ·                 0.452 (0.000)  ·                 0.483 (0.000)  │
 ···································|································|·································
 |  NodeModule                      ·                20.818 (0.000)  ·                20.863 (0.000)  │
 ···································|································|·································
 |  NodeRegistry                    ·                 8.724 (0.000)  ·                 8.791 (0.000)  │
 ···································|································|·································
 |  Operator                        ·                18.695 (0.000)  ·                18.740 (0.000)  │
 ···································|································|·································
 |  OperatorContractOnlyJoinPolicy  ·                11.516 (0.000)  ·                11.561 (0.000)  │
 ···································|································|·································
 |  OperatorFactory                 ·                11.744 (0.000)  ·                11.830 (0.000)  │
 ···································|································|·································
 |  Oracle                          ·                 4.589 (0.000)  ·                 4.763 (0.000)  │
 ···································|································|·································
 |  Ownable                         ·                 0.551 (0.000)  ·                 0.694 (0.000)  │
 ···································|································|·································
 |  QueueModule                     ·                21.135 (0.000)  ·                21.180 (0.000)  │
 ···································|································|·································
 |  SafeMath                        ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  SafeMathChainlink               ·                 0.084 (0.000)  ·                 0.118 (0.000)  │
 ···································|································|·································
 |  SafeMathChainlink               ·                 0.074 (0.000)  ·                 0.117 (0.000)  │
 ···································|································|·································
 |  Sponsorship                     ·                11.184 (0.000)  ·                11.229 (0.000)  │
 ···································|································|·································
 |  SponsorshipFactory              ·                10.454 (0.000)  ·                10.540 (0.000)  │
 ···································|································|·································
 |  StakeModule                     ·                23.106 (0.000)  ·                23.152 (0.000)  │
 ···································|································|·································
 |  StakeWeightedAllocationPolicy   ·                13.097 (0.000)  ·                13.142 (0.000)  │
 ···································|································|·································
 |  StandardToken                   ·                 1.501 (0.000)  ·                 1.532 (0.000)  │
 ···································|································|·································
 |  StorageSlotUpgradeable          ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  StorageSlotUpgradeable          ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  StreamrConfig                   ·                10.344 (0.000)  ·                10.418 (0.000)  │
 ···································|································|·································
 |  StreamrConfigV1_1               ·                10.505 (0.000)  ·                10.579 (0.000)  │
 ···································|································|·································
 |  StreamRegistry                  ·                20.528 (0.000)  ·                20.596 (0.000)  │
 ···································|································|·································
 |  StreamRegistryV2                ·                20.520 (0.000)  ·                20.587 (0.000)  │
 ···································|································|·································
 |  StreamRegistryV3                ·                22.183 (0.000)  ·                22.251 (0.000)  │
 ···································|································|·································
 |  StreamRegistryV4                ·                23.188 (0.000)  ·                23.257 (0.000)  │
 ···································|································|·································
 |  StreamRegistryV4_1              ·                23.265 (0.000)  ·                23.333 (0.000)  │
 ···································|································|·································
 |  StreamRegistryV5                ·                23.490 (0.000)  ·                23.559 (0.000)  │
 ···································|································|·································
 |  StreamRegistryV5_1              ·                23.567 (0.000)  ·                23.636 (0.000)  │
 ···································|································|·································
 |  StreamStorageRegistry           ·                 7.505 (0.000)  ·                 7.572 (0.000)  │
 ···································|································|·································
 |  StreamStorageRegistryV2         ·                 7.833 (0.000)  ·                 7.900 (0.000)  │
 ···································|································|·································
 |  Strings                         ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  StringsUpgradeable              ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  StringsUpgradeable              ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  TestAllocationPolicy            ·                12.381 (0.000)  ·                12.426 (0.000)  │
 ···································|································|·································
 |  TestBadOperator                 ·                 2.888 (0.000)  ·                 2.953 (0.000)  │
 ···································|································|·································
 |  TestExchangeRatePolicy          ·                 0.397 (0.000)  ·                 0.429 (0.000)  │
 ···································|································|·································
 |  TestExchangeRatePolicy2         ·                 0.464 (0.000)  ·                 0.495 (0.000)  │
 ···································|································|·································
 |  TestExchangeRatePolicy3         ·                 0.392 (0.000)  ·                 0.423 (0.000)  │
 ···································|································|·································
 |  TestJoinPolicy                  ·                11.453 (0.000)  ·                11.498 (0.000)  │
 ···································|································|·································
 |  TestKickPolicy                  ·                11.760 (0.000)  ·                11.805 (0.000)  │
 ···································|································|·································
 |  TestToken                       ·                 2.818 (0.000)  ·                 3.466 (0.000)  │
 ···································|································|·································
 |  TokenBalanceWeightStrategy      ·                 0.390 (0.000)  ·                 0.533 (0.000)  │
 ···································|································|·································
 |  TrackerRegistry                 ·                 5.609 (0.000)  ·                 8.042 (0.000)  │
 ···································|································|·································
 |  VoteKickPolicy                  ·                19.976 (0.000)  ·                20.021 (0.000)  │
 ···································|································|·································
 |  WeightedNodeRegistry            ·                 9.456 (0.000)  ·                 9.523 (0.000)  │
 ···································|································|·································
 |  WhitelistPaymaster              ·                 4.631 (0.000)  ·                 4.754 (0.000)  │
 ·----------------------------------|--------------------------------|--------------------------------·
You have both ethereum-waffle and @nomicfoundation/hardhat-chai-matchers installed. They don't work correctly together, so please make sure you only use one.

We recommend you migrate to @nomicfoundation/hardhat-chai-matchers. Learn how to do it here: https://hardhat.org/migrate-from-waffle
Checking network polygon
    {
  name: 'matic',
  chainId: 137,
  ensAddress: null,
  _defaultProvider: null
}
Checking StreamRegistry at 0x0D483E10612F327FC11965Fc82E90dC19b141641
    0x2de84d9fbdf6d06e2cc584295043dbd76046423b9f8bae9426d4fa5e7c03f4a7 [OK]
Balance of 0x72ea90e2Fe101090fc44156cae3141527AE9F429: 1.215501012037107935 native tokens
Checking new StreamRegistry at 0x0D483E10612F327FC11965Fc82E90dC19b141641
    0xbc6e092677d3938fa44d98435a824f9921ff50822ce3ae9111b53784379cd87e [OK]
Implementation address: 0x6C6723Ac723928F9dE696fA6eb282132926924F0
Spent 0.301507424201197477 ETH for gas
+ declare -p ETHERSCAN_KEY
+ echo 'Using *scan API key from environment variable ETHERSCAN_KEY'
Using *scan API key from environment variable ETHERSCAN_KEY
++ cat newImplementationAddress.txt
+ export ADDRESS=0x6C6723Ac723928F9dE696fA6eb282132926924F0
+ ADDRESS=0x6C6723Ac723928F9dE696fA6eb282132926924F0
+ npm run verify

> @streamr/network-contracts@7.1.1 verify
> hardhat verify $ADDRESS --network $CHAIN --show-stack-traces

You have both ethereum-waffle and @nomicfoundation/hardhat-chai-matchers installed. They don't work correctly together, so please make sure you only use one.

We recommend you migrate to @nomicfoundation/hardhat-chai-matchers. Learn how to do it here: https://hardhat.org/migrate-from-waffle
Nothing to compile
No need to generate any newer typings.
 ·----------------------------------|--------------------------------|--------------------------------·
 |  Solc version: 0.8.13            ·  Optimizer enabled: true       ·  Runs: 100                     │
 ···································|································|·································
 |  Contract Name                   ·  Deployed size (KiB) (change)  ·  Initcode size (KiB) (change)  │
 ···································|································|·································
 |  AcceptEverythingPaymaster       ·                 3.571 (0.000)  ·                 3.694 (0.000)  │
 ···································|································|·································
 |  AddressUpgradeable              ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  AddressUpgradeable              ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  AdminKickPolicy                 ·                11.931 (0.000)  ·                11.976 (0.000)  │
 ···································|································|·································
 |  BasicToken                      ·                 0.497 (0.000)  ·                 0.528 (0.000)  │
 ···································|································|·································
 |  BufferChainlink                 ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  CBORChainlink                   ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  Chainlink                       ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  ClonesUpgradeable               ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  DefaultDelegationPolicy         ·                18.962 (0.000)  ·                19.007 (0.000)  │
 ···································|································|·································
 |  DefaultExchangeRatePolicy       ·                18.966 (0.000)  ·                19.011 (0.000)  │
 ···································|································|·································
 |  DefaultLeavePolicy              ·                11.669 (0.000)  ·                11.714 (0.000)  │
 ···································|································|·································
 |  DefaultUndelegationPolicy       ·                19.318 (0.000)  ·                19.363 (0.000)  │
 ···································|································|·································
 |  ECDSA                           ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  ECDSAUpgradeable                ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  ENSCache                        ·                 7.256 (0.000)  ·                 7.967 (0.000)  │
 ···································|································|·································
 |  ENSCacheV1                      ·                 6.815 (0.000)  ·                 7.526 (0.000)  │
 ···································|································|·································
 |  ENSCacheV2Streamr               ·                 5.178 (0.000)  ·                 5.252 (0.000)  │
 ···································|································|·································
 |  ENSRegistry                     ·                 2.417 (0.000)  ·                 2.504 (0.000)  │
 ···································|································|·································
 |  ERC20                           ·                 2.190 (0.000)  ·                 2.832 (0.000)  │
 ···································|································|·································
 |  ERC20Mintable                   ·                 2.525 (0.000)  ·                 3.192 (0.000)  │
 ···································|································|·································
 |  ERC20Upgradeable                ·                 2.097 (0.000)  ·                 2.128 (0.000)  │
 ···································|································|·································
 |  FIFSRegistrar                   ·                 0.574 (0.000)  ·                 0.731 (0.000)  │
 ···································|································|·································
 |  Forwarder                       ·                 4.759 (0.000)  ·                 5.229 (0.000)  │
 ···································|································|·································
 |  GsnEip712Library                ·                 1.294 (0.000)  ·                 1.351 (0.000)  │
 ···································|································|·································
 |  GsnUtils                        ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  LinkToken                       ·                 2.676 (0.000)  ·                 2.736 (0.000)  │
 ···································|································|·································
 |  MathUpgradeable                 ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  MaxOperatorsJoinPolicy          ·                11.454 (0.000)  ·                11.499 (0.000)  │
 ···································|································|·································
 |  MinimalForwarder                ·                 2.813 (0.000)  ·                 3.156 (0.000)  │
 ···································|································|·································
 |  MinimalForwarderUpgradeable     ·                 2.394 (0.000)  ·                 2.425 (0.000)  │
 ···································|································|·································
 |  MinLibBytes                     ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  MockERC1271                     ·                 1.637 (0.000)  ·                 1.668 (0.000)  │
 ···································|································|·································
 |  MockRandomOracle                ·                 0.734 (0.000)  ·                 0.921 (0.000)  │
 ···································|································|·································
 |  NetworkParameters               ·                 1.621 (0.000)  ·                 2.296 (0.000)  │
 ···································|································|·································
 |  NodeDomainNameHelper            ·                 0.452 (0.000)  ·                 0.483 (0.000)  │
 ···································|································|·································
 |  NodeModule                      ·                20.818 (0.000)  ·                20.863 (0.000)  │
 ···································|································|·································
 |  NodeRegistry                    ·                 8.724 (0.000)  ·                 8.791 (0.000)  │
 ···································|································|·································
 |  Operator                        ·                18.695 (0.000)  ·                18.740 (0.000)  │
 ···································|································|·································
 |  OperatorContractOnlyJoinPolicy  ·                11.516 (0.000)  ·                11.561 (0.000)  │
 ···································|································|·································
 |  OperatorFactory                 ·                11.744 (0.000)  ·                11.830 (0.000)  │
 ···································|································|·································
 |  Oracle                          ·                 4.589 (0.000)  ·                 4.763 (0.000)  │
 ···································|································|·································
 |  Ownable                         ·                 0.551 (0.000)  ·                 0.694 (0.000)  │
 ···································|································|·································
 |  QueueModule                     ·                21.135 (0.000)  ·                21.180 (0.000)  │
 ···································|································|·································
 |  SafeMath                        ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  SafeMathChainlink               ·                 0.084 (0.000)  ·                 0.118 (0.000)  │
 ···································|································|·································
 |  SafeMathChainlink               ·                 0.074 (0.000)  ·                 0.117 (0.000)  │
 ···································|································|·································
 |  Sponsorship                     ·                11.184 (0.000)  ·                11.229 (0.000)  │
 ···································|································|·································
 |  SponsorshipFactory              ·                10.454 (0.000)  ·                10.540 (0.000)  │
 ···································|································|·································
 |  StakeModule                     ·                23.106 (0.000)  ·                23.152 (0.000)  │
 ···································|································|·································
 |  StakeWeightedAllocationPolicy   ·                13.097 (0.000)  ·                13.142 (0.000)  │
 ···································|································|·································
 |  StandardToken                   ·                 1.501 (0.000)  ·                 1.532 (0.000)  │
 ···································|································|·································
 |  StorageSlotUpgradeable          ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  StorageSlotUpgradeable          ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  StreamrConfig                   ·                10.344 (0.000)  ·                10.418 (0.000)  │
 ···································|································|·································
 |  StreamrConfigV1_1               ·                10.505 (0.000)  ·                10.579 (0.000)  │
 ···································|································|·································
 |  StreamRegistry                  ·                20.528 (0.000)  ·                20.596 (0.000)  │
 ···································|································|·································
 |  StreamRegistryV2                ·                20.520 (0.000)  ·                20.587 (0.000)  │
 ···································|································|·································
 |  StreamRegistryV3                ·                22.183 (0.000)  ·                22.251 (0.000)  │
 ···································|································|·································
 |  StreamRegistryV4                ·                23.188 (0.000)  ·                23.257 (0.000)  │
 ···································|································|·································
 |  StreamRegistryV4_1              ·                23.265 (0.000)  ·                23.333 (0.000)  │
 ···································|································|·································
 |  StreamRegistryV5                ·                23.490 (0.000)  ·                23.559 (0.000)  │
 ···································|································|·································
 |  StreamRegistryV5_1              ·                23.567 (0.000)  ·                23.636 (0.000)  │
 ···································|································|·································
 |  StreamStorageRegistry           ·                 7.505 (0.000)  ·                 7.572 (0.000)  │
 ···································|································|·································
 |  StreamStorageRegistryV2         ·                 7.833 (0.000)  ·                 7.900 (0.000)  │
 ···································|································|·································
 |  Strings                         ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  StringsUpgradeable              ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  StringsUpgradeable              ·                 0.084 (0.000)  ·                 0.138 (0.000)  │
 ···································|································|·································
 |  TestAllocationPolicy            ·                12.381 (0.000)  ·                12.426 (0.000)  │
 ···································|································|·································
 |  TestBadOperator                 ·                 2.888 (0.000)  ·                 2.953 (0.000)  │
 ···································|································|·································
 |  TestExchangeRatePolicy          ·                 0.397 (0.000)  ·                 0.429 (0.000)  │
 ···································|································|·································
 |  TestExchangeRatePolicy2         ·                 0.464 (0.000)  ·                 0.495 (0.000)  │
 ···································|································|·································
 |  TestExchangeRatePolicy3         ·                 0.392 (0.000)  ·                 0.423 (0.000)  │
 ···································|································|·································
 |  TestJoinPolicy                  ·                11.453 (0.000)  ·                11.498 (0.000)  │
 ···································|································|·································
 |  TestKickPolicy                  ·                11.760 (0.000)  ·                11.805 (0.000)  │
 ···································|································|·································
 |  TestToken                       ·                 2.818 (0.000)  ·                 3.466 (0.000)  │
 ···································|································|·································
 |  TokenBalanceWeightStrategy      ·                 0.390 (0.000)  ·                 0.533 (0.000)  │
 ···································|································|·································
 |  TrackerRegistry                 ·                 5.609 (0.000)  ·                 8.042 (0.000)  │
 ···································|································|·································
 |  VoteKickPolicy                  ·                19.976 (0.000)  ·                20.021 (0.000)  │
 ···································|································|·································
 |  WeightedNodeRegistry            ·                 9.456 (0.000)  ·                 9.523 (0.000)  │
 ···································|································|·································
 |  WhitelistPaymaster              ·                 4.631 (0.000)  ·                 4.754 (0.000)  │
 ·----------------------------------|--------------------------------|--------------------------------·
Successfully submitted source code for contract
contracts/StreamRegistry/StreamRegistryV5.sol:StreamRegistryV5 at 0x6C6723Ac723928F9dE696fA6eb282132926924F0
for verification on the block explorer. Waiting for verification result...

Successfully verified contract StreamRegistryV5 on Etherscan.
https://polygonscan.com/address/0x6C6723Ac723928F9dE696fA6eb282132926924F0#code
+ rm newImplementationAddress.txt