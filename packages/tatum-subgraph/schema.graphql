type Bounty @entity {
  id: ID! # bounty address
  isRunning: Boolean!
  stakes: [Stake!]! @derivedFrom(field: "bounty")
  brokerCount: Int!
  totalStakedWei: BigInt!
  unallocatedWei: BigInt!
  projectedInsolvency: BigInt!
  flags: [Flag!]! @derivedFrom(field: "bounty")
}

type Stake @entity {
  id: ID! # 0xbountyAddress-0xbrokerAddress
  broker: String!
  amount: BigInt!
  allocatedWei: BigInt!
  date: BigInt
  bounty: Bounty
  pool: BrokerPool
}

type Flag @entity {
  id: ID! # 0xbountyAddress-0xbrokerAddress
  flagger: BrokerPool!
  target: BrokerPool!
  # flagStake: BigInt! always fixed?
  date: BigInt
  bounty: Bounty
  result: BigInt! # 0: pending, 1: target kicked, 2: flag failed
  targetSlashAmount: BigInt
}

type BrokerPool @entity {
  id: ID! # pool address
  stakes: [Stake!]! @derivedFrom(field: "pool")
  delegators: [PoolDelegation!]! @derivedFrom(field: "pool")
  delegatorCount: Int
  approximatePoolValue: BigInt!
  unallocatedWei: BigInt!
  flagsOpened: [Flag!]! @derivedFrom(field: "flagger")
  flagsTargeted: [Flag!]! @derivedFrom(field: "target")
}

type PoolDelegation @entity {
  id: ID! # 0xpoolAddress-0xbrokerAddress
  delegator: String!
  amount: BigInt!
  pool: BrokerPool
}